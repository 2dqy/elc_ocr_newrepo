<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Dashboard - 數據分析</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.dataTables.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.bootstrap5.css"/>
    <!-- Chart.js for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 密码验证界面 -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-container">
            <div class="password-icon">🔒</div>
            <h2>訪問驗證</h2>
            <p class="text-muted">請輸入密碼訪問 OCR Dashboard</p>
            <form id="passwordForm">
                <input type="password" id="passwordInput" class="password-input" placeholder="請輸入密碼" maxlength="10">
                <button type="submit" class="password-submit">確認</button>
                <div id="passwordError" class="password-error" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- 主要內容（默認隱藏） -->
    <div id="mainContent" style="display: none;">
        <div class="dashboard-header">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <h1><i class="fas fa-chart-bar"></i> OCR Dashboard</h1>
                        <p class="mb-0">數據分析與監控中心</p>
                    </div>
                    <div class="col-md-4">
                        <div class="month-selector">
                            <label for="monthInput" class="form-label text-white">選擇月份:</label>
                            <div class="input-group">
                                <input type="month" id="monthInput" class="form-control month-input" placeholder="YYYY-MM">
                                <button class="btn btn-outline-light" type="button" id="currentMonthBtn">當月</button>
                            </div>
                            <small class="text-white-50">
                                <span id="currentMonthIndicator"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- 加載狀態 -->
            <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">加載中...</span>
                </div>
                <p class="mt-2">正在加載數據...</p>
            </div>

            <!-- 錯誤信息 -->
            <div id="errorMessage" class="error-message" style="display: none;">
                <strong>錯誤：</strong> <span id="errorText"></span>
            </div>

            <!-- 主要內容區域 -->
            <div id="dashboardContent" style="display: none;">
                <!-- 統計卡片 -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="totalRequests" class="stats-number">0</div>
                            <div class="stats-label">總請求數</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="successRate" class="stats-number">0%</div>
                            <div class="stats-label">總體成功率</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="avgProcessingTime" class="stats-number">0s</div>
                            <div class="stats-label">平均處理時間</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="totalCenters" class="stats-number">0</div>
                            <div class="stats-label">活躍中心數</div>
                        </div>
                    </div>
                </div>

                <!-- 圖表區域 -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>中心成功率分析</h5>
                            <div class="chart-container">
                                <canvas id="centerSuccessChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>設備類型分析</h5>
                            <div class="chart-container">
                                <canvas id="deviceAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>失敗原因分析</h5>
                            <div class="chart-container">
                                <canvas id="errorAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 數據表格區域 -->
                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>中心排名</h5>
                            <table id="centerRankingTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>排名</th>
                                    <th>中心ID</th>
                                    <th>成功請求數</th>
                                    <th>總請求數</th>
                                    <th>成功率</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>設備類型統計</h5>
                            <table id="deviceAnalysisTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>設備類型</th>
                                    <th>總請求數</th>
                                    <th>成功請求數</th>
                                    <th>成功率</th>
                                    <th>平均處理時間(s)</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>失敗原因詳細</h5>
                            <table id="errorAnalysisTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>錯誤信息</th>
                                    <th>錯誤次數</th>
                                    <th>佔失敗總數比例</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">原始數據</h5>
                                <button id="exportCsvBtn" class="btn btn-success btn-sm">
                                    <i class="fas fa-download"></i> Export CSV
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table id="rawDataTable" class="table table-striped table-hover">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>時間</th>
                                        <th>客戶端IP</th>
                                        <th>Token</th>
                                        <th>API端點</th>
                                        <th>中心ID</th>
                                        <th>設備類型</th>
                                        <th>文件上傳ID</th>
                                        <th>文件名</th>
                                        <th>文件大小(B)</th>
                                        <th>狀態</th>
                                        <th>處理時間(s)</th>
                                        <th>AI使用量</th>
                                        <th>剩餘次數</th>
                                        <th>原始次數</th>
                                        <th>錯誤信息</th>
                                        <th>錯誤代碼</th>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/2.3.1/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.3.1/js/dataTables.bootstrap5.js"></script>
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>

    <script>

    </script>

    <script src="/static/js/dashboard.js"></script>

</body>
</html>