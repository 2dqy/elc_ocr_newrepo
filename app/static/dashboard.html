<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR Dashboard - 数据分析</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.dataTables.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.bootstrap5.css"/>
    <!-- Chart.js for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 密码验证界面 -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-container">
            <div class="password-icon">🔒</div>
            <h2>访问验证</h2>
            <p class="text-muted">请输入密码访问 OCR Dashboard</p>
            <form id="passwordForm">
                <input type="password" id="passwordInput" class="password-input" placeholder="请输入密码" maxlength="10">
                <button type="submit" class="password-submit">确认</button>
                <div id="passwordError" class="password-error" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- 主要内容（默认隐藏） -->
    <div id="mainContent" style="display: none;">
        <div class="dashboard-header">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <h1><i class="fas fa-chart-bar"></i> OCR Dashboard</h1>
                        <p class="mb-0">数据分析与监控中心</p>
                    </div>
                    <div class="col-md-4">
                        <div class="month-selector">
                            <label for="monthInput" class="form-label text-white">选择月份:</label>
                            <div class="input-group">
                                <input type="month" id="monthInput" class="form-control month-input" placeholder="YYYY-MM">
                                <button class="btn btn-outline-light" type="button" id="currentMonthBtn">当月</button>
                            </div>
                            <small class="text-white-50">
                                <span id="currentMonthIndicator"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- 加载状态 -->
            <div id="loadingSpinner" class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
                <p class="mt-2">正在加载数据...</p>
            </div>

            <!-- 错误信息 -->
            <div id="errorMessage" class="error-message" style="display: none;">
                <strong>错误：</strong> <span id="errorText"></span>
            </div>

            <!-- 主要内容区域 -->
            <div id="dashboardContent" style="display: none;">
                <!-- 统计卡片 -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="totalRequests" class="stats-number">0</div>
                            <div class="stats-label">总请求数</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="successRate" class="stats-number">0%</div>
                            <div class="stats-label">总体成功率</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="avgProcessingTime" class="stats-number">0s</div>
                            <div class="stats-label">平均处理时间</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card text-center">
                            <div id="totalCenters" class="stats-number">0</div>
                            <div class="stats-label">活跃中心数</div>
                        </div>
                    </div>
                </div>

                <!-- 图表区域 -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>中心成功率分析</h5>
                            <div class="chart-container">
                                <canvas id="centerSuccessChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>设备类型分析</h5>
                            <div class="chart-container">
                                <canvas id="deviceAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>失败原因分析</h5>
                            <div class="chart-container">
                                <canvas id="errorAnalysisChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 数据表格区域 -->
                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>中心排名</h5>
                            <table id="centerRankingTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>排名</th>
                                    <th>中心ID</th>
                                    <th>成功请求数</th>
                                    <th>总请求数</th>
                                    <th>成功率</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>设备类型统计</h5>
                            <table id="deviceAnalysisTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>设备类型</th>
                                    <th>总请求数</th>
                                    <th>成功请求数</th>
                                    <th>成功率</th>
                                    <th>平均处理时间(s)</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>失败原因详细</h5>
                            <table id="errorAnalysisTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>错误信息</th>
                                    <th>错误次数</th>
                                    <th>占失败总数比例</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="stats-card">
                            <h5>原始数据</h5>
                            <table id="rawDataTable" class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>Token</th>
                                    <th>中心ID</th>
                                    <th>设备类型</th>
                                    <th>文件名</th>
                                    <th>状态</th>
                                    <th>处理时间(s)</th>
                                    <th>AI使用量</th>
                                    <th>剩余次数</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/2.3.1/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.3.1/js/dataTables.bootstrap5.js"></script>
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>

    <script>

    </script>

    <script src="/static/js/dashboard.js"></script>

</body>
</html>